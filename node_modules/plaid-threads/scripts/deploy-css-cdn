#!/usr/bin/env bash
set -e


# Env Vars
#############################

if [ -z "${S3_KEY+x}" ] ; then
  echo 'No environment variable named "S3_KEY"' >&2
  exit 1
fi
if [ -z "${S3_SECRET+x}" ] ; then
  echo 'No environment variable named "S3_SECRET"' >&2
  exit 1
fi

S3_BUCKET='plaid-threads-docs'
BUILD_DIR='build'


# Setup and build directory
#############################
PLAID_ENV=production
make build-css


# Publish to AWS S3
#############################

echo 'Publishing files...'
aws s3 cp "$BUILD_DIR" "s3://$S3_BUCKET" --recursive
echo 'Publish complete!'

echo 'Invalidating cache...'
aws cloudfront create-invalidation --distribution-id ELTC8HLEZFSVD --paths '/threads.css'
echo 'Invalidating will likely take 15 minutes.'
