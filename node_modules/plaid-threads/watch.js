const Metalsmith = require('metalsmith');
const assets     = require('metalsmith-assets');
const layouts    = require('metalsmith-layouts');
const markdown   = require('metalsmith-markdown');
const permalinks = require('metalsmith-permalinks');
const sass       = require('metalsmith-sass');
const serve      = require('metalsmith-serve');
const watch      = require('metalsmith-watch');

Metalsmith(__dirname)
  .source('./docs/scss')
  .destination('./build')
  .clean(false)
  .use(sass({
    outputStyle: 'expanded',
    outputDir: './',
  }))
  .use(watch({
    livereload: false,
  }))
  .build(function(err, files) {
    if (err != null) {
      throw err;
    }
  });

Metalsmith(__dirname)
  .source('./docs/views')
  .destination('./build')
  .clean(false)
  .use(markdown())
  .use(permalinks())
  .use(layouts({
    engine: 'handlebars',
    partials: 'docs/partials',
    directory: 'docs',
  }))
  .use(serve({
    port: 3000,
    verbose: true,
  }))
  .use(watch({
    paths: {
      'docs/**/*': true,
    },
    livereload: true,
  }))
  .build(function(err, files) {
    if (err != null) {
      throw err;
    }
  });
